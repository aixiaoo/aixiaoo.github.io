<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IP桌子基础版 | 小伞云</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="小伞云带你走上成功路">
    <link rel="preload" href="/assets/css/0.styles.7aeb3c16.css" as="style"><link rel="preload" href="/assets/js/app.2278ea87.js" as="script"><link rel="preload" href="/assets/js/2.97abfa37.js" as="script"><link rel="preload" href="/assets/js/9.702be4a3.js" as="script"><link rel="prefetch" href="/assets/js/10.d8a96397.js"><link rel="prefetch" href="/assets/js/11.d70a2a3c.js"><link rel="prefetch" href="/assets/js/12.314e5655.js"><link rel="prefetch" href="/assets/js/13.74894463.js"><link rel="prefetch" href="/assets/js/3.27c41a06.js"><link rel="prefetch" href="/assets/js/4.ea732ec2.js"><link rel="prefetch" href="/assets/js/5.62b3ba36.js"><link rel="prefetch" href="/assets/js/6.f1d3a645.js"><link rel="prefetch" href="/assets/js/7.ff6b1519.js"><link rel="prefetch" href="/assets/js/8.600fa0b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7aeb3c16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.png" alt="小伞云" class="logo"> <span class="site-name can-hide">小伞云</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="https://www.taoluyun.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小伞云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="https://www.taoluyun.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小伞云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>简介</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>新手上路</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>软件文档</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/soft/iptables-basis.html" class="active sidebar-link">IP桌子基础版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#环境要求：" class="sidebar-link">环境要求：</a></li><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#_1-服务端部署" class="sidebar-link">1.服务端部署</a></li><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#_2-设置服务端" class="sidebar-link">2.设置服务端</a></li><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#_3-被控端部署" class="sidebar-link">3.被控端部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#开启转发-此处为逗比脚本-：" class="sidebar-link">开启转发(此处为逗比脚本)：</a></li></ul></li><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#_4-添加映射规则" class="sidebar-link">4.添加映射规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#大功告成！" class="sidebar-link">大功告成！</a></li></ul></li><li class="sidebar-sub-header"><a href="/soft/iptables-basis.html#tips" class="sidebar-link">TIPS</a></li></ul></li><li><a href="/soft/iptables-shield.html" class="sidebar-link">IP盾构机</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ip桌子基础版"><a href="#ip桌子基础版" class="header-anchor">#</a> IP桌子基础版</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <blockquote><p><code>IP桌子基础版</code>是一个<code>WEB管理iptables转发规则面板</code>，支持控制多台服务器，无数量限制。
基于<code>iptables</code>内核级转发，高效稳定，低资源占用无断流</p></blockquote> <h2 id="环境要求："><a href="#环境要求：" class="header-anchor">#</a> 环境要求：</h2> <ol><li>php7.1+(推荐7.2)</li> <li>mysql5.6+</li> <li>nginx</li></ol> <hr> <h2 id="_1-服务端部署"><a href="#_1-服务端部署" class="header-anchor">#</a> 1.服务端部署</h2> <p><strong>提前解析好域名到服务端上，避免部署完之后还要等待DNS生效。</strong></p> <p>在<code>宝塔面板</code>创建站点</p> <p><img src="https://s1.ax1x.com/2020/04/19/JKFzlt.png" alt="JKFzlt.png"></p> <p>将<code>Github</code>里的<code>rules-panel/Mater/</code>上传。</p> <p><img src="https://s1.ax1x.com/2020/04/19/JKk5NQ.png" alt="JKk5NQ.png"></p> <p>在<code>网站-网站设置-网站目录</code>下将<code>pubilc</code>设置为<code>运行文件夹</code>。</p> <p><img src="https://s1.ax1x.com/2020/04/19/JKkxN4.png" alt="JKkxN4.png"></p> <p>在<code>网站-网站设置-伪静态</code>设置<code>伪静态</code>，点击<code>保存</code>。</p> <p><code>Nginx</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /{     
    if (!-e $request_filename) {       
        rewrite ^/(.*)$ /index.php/$1 last;       
        break;     
    }    
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://s1.ax1x.com/2020/04/19/JKAJUg.png" alt="JKAJUg.png"></p> <p>打开<code>数据库-对应数据库-管理</code>（phpMyAdmin），导入<code>test.sql</code>。</p> <p>导入完成后应该有七张表。</p> <p><img src="https://s1.ax1x.com/2020/04/19/JKVkkD.png" alt="JKVkkD.png"></p> <p>修改<code>/app/config.php</code>来<code>连接数据库</code>。
<img src="https://s1.ax1x.com/2020/04/19/JKVdBV.png" alt="JKVdBV.png"></p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
	<span class="token single-quoted-string string">'db_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mysql'</span><span class="token punctuation">,</span>
	<span class="token single-quoted-string string">'db_host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>
	<span class="token single-quoted-string string">'db_name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">,</span>
	<span class="token single-quoted-string string">'db_user'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">,</span>
	<span class="token single-quoted-string string">'db_pass'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'123456'</span><span class="token punctuation">,</span>

	<span class="token single-quoted-string string">'debug_trace'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">false</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>至此，服务端部署完成。</p> <hr> <h2 id="_2-设置服务端"><a href="#_2-设置服务端" class="header-anchor">#</a> 2.设置服务端</h2> <p>打开网站，登录面板。
默认用户名是<code>admin</code>，密码是<code>123456</code>。</p> <p>在服务器列表处，添加服务器。</p> <p><code>名称</code>随便填
<code>DDNS的服务器</code>填<code>CNAME</code>，<code>静态IP</code>填<code>IP</code> <code>端口</code>填<code>22</code></p> <p>由于<code>小伞云IPLC二期NAT</code>是<code>动态IP</code>，这里我们打开<code>动态IP</code>开关。</p> <p><img src="https://s1.ax1x.com/2020/04/19/JKeWFO.png" alt="JKeWFO.png"></p> <p>添加完毕后，我们会得到一个<code>key</code>，<strong>复制下来，待会被控端部署有用</strong>。</p> <p>打开用户列表，点击权限，勾选对应服务器。</p> <p><img src="https://s1.ax1x.com/2020/04/19/JKmBAf.png" alt="JKmBAf.png"></p> <hr> <h2 id="_3-被控端部署"><a href="#_3-被控端部署" class="header-anchor">#</a> 3.被控端部署</h2> <h3 id="开启转发-此处为逗比脚本-："><a href="#开启转发-此处为逗比脚本-：" class="header-anchor">#</a> 开启转发(此处为逗比脚本)：</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> http://ftp.taoluyun.cc/iptables-pf.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x iptables-pf.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后执行 <code>./iptables-pf.sh</code> 执行选项1安装iptables</p> <p>保存防火墙</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>iptables -F
iptables -t nat -F
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>Centos</code>执行:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">service</span> iptables save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Debian</code>执行:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>iptables-save <span class="token operator">&gt;</span> /etc/iptables.up.rules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="下载被控文件："><a href="#下载被控文件：" class="header-anchor">#</a> 下载被控文件：</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> http://ftp.taoluyun.cc/ip_table <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x ip_table
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="设定定时任务："><a href="#设定定时任务：" class="header-anchor">#</a> 设定定时任务：</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>*/5 * * * * <span class="token builtin class-name">.</span> /etc/profile<span class="token punctuation">;</span>/root/ip_table ABC123defg <span class="token number">10.153</span>.1.1 http://ip.example.com/api
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明:</h4> <ul><li><p><code>ABC123defg</code> 为主控面板添加服务器后，分配的<code>key</code></p></li> <li><p>10.153.1.1 为主网卡上的IP，查看方法：ip addr。如果您的<code>IP</code>为<code>公网IP</code>，并且是<code>动态IP</code>，当IP变动时需要修改此处</p></li> <li><p>后面的<code>ip.example.com</code>请自行替换为您的域名</p></li></ul> <hr> <h2 id="_4-添加映射规则"><a href="#_4-添加映射规则" class="header-anchor">#</a> 4.添加映射规则</h2> <p>似乎这个网站有点bug，需要开<code>无痕模式</code>或者<code>清理cookies</code></p> <h4 id="然后重新登录管理权限才会更新"><a href="#然后重新登录管理权限才会更新" class="header-anchor">#</a> 然后重新登录<strong>管理权限才会更新</strong></h4> <p>假设我们已经创建映射：<code>cen-sz.example.com:15555 -&gt; 10.153.1.1:23333</code></p> <p>数据需要转发到<code>v.example.com:443</code></p> <p>那么
<code>本地端口</code>填<code>内网端口</code> <code>本地IP</code>填<code>内网IP</code>
当转发的服务器是IP时，填写IP，否则填写DDNS。
<img src="https://s1.ax1x.com/2020/04/19/JKuyOs.png" alt="JKuyOs.png"></p> <p>添加完成后，等待几分钟，即可看到面板上的<code>已生效</code>。</p> <p>连接时填：<code>cen-sz.example.com:15555</code>即可做到用IPLC-NAT来中转，<code>v2ray</code>的伪装域名依旧不变。</p> <h3 id="大功告成！"><a href="#大功告成！" class="header-anchor">#</a> 大功告成！</h3> <hr> <h2 id="tips"><a href="#tips" class="header-anchor">#</a> TIPS</h2> <ol><li>这里为了简单起见，数据库名<code>admin</code>,数据库用户名<code>admin</code>，数据库密码<code>123456</code>。但与面板的默认用户名和密码<strong>并没有关系</strong>，它们是受<code>test.sql</code>设置，<code>config.php</code>里的连接就是连接数据库的，才与上面的数据库设置有关系。</li> <li><code>Apache</code>一样可以，只是我用了<code>Nginx</code></li> <li><code>宝塔面板</code>并<code>不是必要的</code>，只是为了简单起见做演示，设置较为方便</li> <li>设置了权限之后如果没有生效，试试开无痕，似乎有bug。</li> <li>服务端和要转发到的服务器<strong>都不是必须要有独立IP的</strong>，<strong>NAT也可以</strong>，只不过过程较为繁琐。</li> <li>这里说准备好一台部署好的v2+ws+tls的服务器，只是为了强化实际应用，实际上这个的效果只是<strong>端口转发</strong>，SSH和SSR的数据一样可以。</li> <li>这篇教程<strong>为新手准备</strong>，说得较为繁琐，dalao完全可以不看，<strong>直接看<code>Github</code>上的<code>readme.md</code>就行了</strong></li> <li>上述教程忽略了服务端的定时任务（<strong>作用：更新DDNS</strong>），需要的自行去Github看教程。</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/22/2020, 6:04:55 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/start/natserver-use.html" class="prev">
        NAT服务器使用方法
      </a></span> <span class="next"><a href="/soft/iptables-shield.html">
        IP盾构机
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2278ea87.js" defer></script><script src="/assets/js/2.97abfa37.js" defer></script><script src="/assets/js/9.702be4a3.js" defer></script>
  </body>
</html>
