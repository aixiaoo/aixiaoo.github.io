(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{358:function(s,t,a){"use strict";a.r(t);var e=a(43),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ip桌子基础版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ip桌子基础版"}},[s._v("#")]),s._v(" IP桌子基础版")]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("IP桌子基础版")]),s._v("是一个"),a("code",[s._v("WEB管理iptables转发规则面板")]),s._v("，支持控制多台服务器，无数量限制。\n基于"),a("code",[s._v("iptables")]),s._v("内核级转发，高效稳定，低资源占用无断流")])]),s._v(" "),a("h2",{attrs:{id:"环境要求："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境要求："}},[s._v("#")]),s._v(" 环境要求：")]),s._v(" "),a("ol",[a("li",[s._v("php7.1+(推荐7.2)")]),s._v(" "),a("li",[s._v("mysql5.6+")]),s._v(" "),a("li",[s._v("nginx")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_1-服务端部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-服务端部署"}},[s._v("#")]),s._v(" 1.服务端部署")]),s._v(" "),a("p",[a("strong",[s._v("提前解析好域名到服务端上，避免部署完之后还要等待DNS生效。")])]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("宝塔面板")]),s._v("创建站点")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKFzlt.png",alt:"JKFzlt.png"}})]),s._v(" "),a("p",[s._v("将"),a("code",[s._v("Github")]),s._v("里的"),a("code",[s._v("rules-panel/Mater/")]),s._v("上传。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKk5NQ.png",alt:"JKk5NQ.png"}})]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("网站-网站设置-网站目录")]),s._v("下将"),a("code",[s._v("pubilc")]),s._v("设置为"),a("code",[s._v("运行文件夹")]),s._v("。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKkxN4.png",alt:"JKkxN4.png"}})]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("网站-网站设置-伪静态")]),s._v("设置"),a("code",[s._v("伪静态")]),s._v("，点击"),a("code",[s._v("保存")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("Nginx")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /{     \n    if (!-e $request_filename) {       \n        rewrite ^/(.*)$ /index.php/$1 last;       \n        break;     \n    }    \n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKAJUg.png",alt:"JKAJUg.png"}})]),s._v(" "),a("p",[s._v("打开"),a("code",[s._v("数据库-对应数据库-管理")]),s._v("（phpMyAdmin），导入"),a("code",[s._v("test.sql")]),s._v("。")]),s._v(" "),a("p",[s._v("导入完成后应该有七张表。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKVkkD.png",alt:"JKVkkD.png"}})]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("/app/config.php")]),s._v("来"),a("code",[s._v("连接数据库")]),s._v("。\n"),a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKVdBV.png",alt:"JKVdBV.png"}})]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'db_type'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'db_host'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'db_name'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'db_user'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'db_pass'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'debug_trace'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean constant"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("至此，服务端部署完成。")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_2-设置服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置服务端"}},[s._v("#")]),s._v(" 2.设置服务端")]),s._v(" "),a("p",[s._v("打开网站，登录面板。\n默认用户名是"),a("code",[s._v("admin")]),s._v("，密码是"),a("code",[s._v("123456")]),s._v("。")]),s._v(" "),a("p",[s._v("在服务器列表处，添加服务器。")]),s._v(" "),a("p",[a("code",[s._v("名称")]),s._v("随便填\n"),a("code",[s._v("DDNS的服务器")]),s._v("填"),a("code",[s._v("CNAME")]),s._v("，"),a("code",[s._v("静态IP")]),s._v("填"),a("code",[s._v("IP")]),s._v(" "),a("code",[s._v("端口")]),s._v("填"),a("code",[s._v("22")])]),s._v(" "),a("p",[s._v("由于"),a("code",[s._v("小伞云IPLC二期NAT")]),s._v("是"),a("code",[s._v("动态IP")]),s._v("，这里我们打开"),a("code",[s._v("动态IP")]),s._v("开关。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKeWFO.png",alt:"JKeWFO.png"}})]),s._v(" "),a("p",[s._v("添加完毕后，我们会得到一个"),a("code",[s._v("key")]),s._v("，"),a("strong",[s._v("复制下来，待会被控端部署有用")]),s._v("。")]),s._v(" "),a("p",[s._v("打开用户列表，点击权限，勾选对应服务器。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKmBAf.png",alt:"JKmBAf.png"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-被控端部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-被控端部署"}},[s._v("#")]),s._v(" 3.被控端部署")]),s._v(" "),a("h3",{attrs:{id:"开启转发-此处为逗比脚本-："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启转发-此处为逗比脚本-："}},[s._v("#")]),s._v(" 开启转发(此处为逗比脚本)：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://ftp.taoluyun.cc/iptables-pf.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x iptables-pf.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后执行 "),a("code",[s._v("./iptables-pf.sh")]),s._v(" 执行选项1安装iptables")]),s._v(" "),a("p",[s._v("保存防火墙")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("iptables -F\niptables -t nat -F\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("Centos")]),s._v("执行:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables save\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("Debian")]),s._v("执行:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("iptables-save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/iptables.up.rules\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"下载被控文件："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载被控文件："}},[s._v("#")]),s._v(" 下载被控文件：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://ftp.taoluyun.cc/ip_table "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ip_table\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"设定定时任务："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设定定时任务："}},[s._v("#")]),s._v(" 设定定时任务：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("*/5 * * * * "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /etc/profile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("/root/ip_table ABC123defg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.153")]),s._v(".1.1 http://ip.example.com/api\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"参数说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明:")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("ABC123defg")]),s._v(" 为主控面板添加服务器后，分配的"),a("code",[s._v("key")])])]),s._v(" "),a("li",[a("p",[s._v("10.153.1.1 为主网卡上的IP，查看方法：ip addr。如果您的"),a("code",[s._v("IP")]),s._v("为"),a("code",[s._v("公网IP")]),s._v("，并且是"),a("code",[s._v("动态IP")]),s._v("，当IP变动时需要修改此处")])]),s._v(" "),a("li",[a("p",[s._v("后面的"),a("code",[s._v("ip.example.com")]),s._v("请自行替换为您的域名")])])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_4-添加映射规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-添加映射规则"}},[s._v("#")]),s._v(" 4.添加映射规则")]),s._v(" "),a("p",[s._v("似乎这个网站有点bug，需要开"),a("code",[s._v("无痕模式")]),s._v("或者"),a("code",[s._v("清理cookies")])]),s._v(" "),a("h4",{attrs:{id:"然后重新登录管理权限才会更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#然后重新登录管理权限才会更新"}},[s._v("#")]),s._v(" 然后重新登录"),a("strong",[s._v("管理权限才会更新")])]),s._v(" "),a("p",[s._v("假设我们已经创建映射："),a("code",[s._v("cen-sz.example.com:15555 -> 10.153.1.1:23333")])]),s._v(" "),a("p",[s._v("数据需要转发到"),a("code",[s._v("v.example.com:443")])]),s._v(" "),a("p",[s._v("那么\n"),a("code",[s._v("本地端口")]),s._v("填"),a("code",[s._v("内网端口")]),s._v(" "),a("code",[s._v("本地IP")]),s._v("填"),a("code",[s._v("内网IP")]),s._v("\n当转发的服务器是IP时，填写IP，否则填写DDNS。\n"),a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JKuyOs.png",alt:"JKuyOs.png"}})]),s._v(" "),a("p",[s._v("添加完成后，等待几分钟，即可看到面板上的"),a("code",[s._v("已生效")]),s._v("。")]),s._v(" "),a("p",[s._v("连接时填："),a("code",[s._v("cen-sz.example.com:15555")]),s._v("即可做到用IPLC-NAT来中转，"),a("code",[s._v("v2ray")]),s._v("的伪装域名依旧不变。")]),s._v(" "),a("h3",{attrs:{id:"大功告成！"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大功告成！"}},[s._v("#")]),s._v(" 大功告成！")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"tips"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tips"}},[s._v("#")]),s._v(" TIPS")]),s._v(" "),a("ol",[a("li",[s._v("这里为了简单起见，数据库名"),a("code",[s._v("admin")]),s._v(",数据库用户名"),a("code",[s._v("admin")]),s._v("，数据库密码"),a("code",[s._v("123456")]),s._v("。但与面板的默认用户名和密码"),a("strong",[s._v("并没有关系")]),s._v("，它们是受"),a("code",[s._v("test.sql")]),s._v("设置，"),a("code",[s._v("config.php")]),s._v("里的连接就是连接数据库的，才与上面的数据库设置有关系。")]),s._v(" "),a("li",[a("code",[s._v("Apache")]),s._v("一样可以，只是我用了"),a("code",[s._v("Nginx")])]),s._v(" "),a("li",[a("code",[s._v("宝塔面板")]),s._v("并"),a("code",[s._v("不是必要的")]),s._v("，只是为了简单起见做演示，设置较为方便")]),s._v(" "),a("li",[s._v("设置了权限之后如果没有生效，试试开无痕，似乎有bug。")]),s._v(" "),a("li",[s._v("服务端和要转发到的服务器"),a("strong",[s._v("都不是必须要有独立IP的")]),s._v("，"),a("strong",[s._v("NAT也可以")]),s._v("，只不过过程较为繁琐。")]),s._v(" "),a("li",[s._v("这里说准备好一台部署好的v2+ws+tls的服务器，只是为了强化实际应用，实际上这个的效果只是"),a("strong",[s._v("端口转发")]),s._v("，SSH和SSR的数据一样可以。")]),s._v(" "),a("li",[s._v("这篇教程"),a("strong",[s._v("为新手准备")]),s._v("，说得较为繁琐，dalao完全可以不看，"),a("strong",[s._v("直接看"),a("code",[s._v("Github")]),s._v("上的"),a("code",[s._v("readme.md")]),s._v("就行了")])]),s._v(" "),a("li",[s._v("上述教程忽略了服务端的定时任务（"),a("strong",[s._v("作用：更新DDNS")]),s._v("），需要的自行去Github看教程。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);